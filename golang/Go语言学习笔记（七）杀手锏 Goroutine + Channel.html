<html>
<head>
  <title>Go语言学习笔记（七）杀手锏 Goroutine + Channel</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/305825 (zh-CN, DDL); Windows/6.1.7601 Service Pack 1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="328"/>
<h1>Go语言学习笔记（七）杀手锏 Goroutine + Channel</h1>

<div>
<span><div><br/></div><div style="font-size: 16px; display: inline-block;"><div style="background-color: white; font-size: 14px;"><div style="min-width: 0px; background-color: rgb(255, 255, 255); box-shadow: rgba(100, 100, 100, 0.298039) 0px 2px 6px;"><div style="text-align: left;"><div style="text-overflow: ellipsis; overflow: hidden;"><div style="text-overflow: ellipsis; overflow: hidden;"><div style="font-size: 14px;"><div style="word-break: break-word;"><h1 style="padding: 0px; font-size: 28px; margin: 10px 0px;"><span style="font-size: 28px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.5; font-weight: bold;">Goroutine</span></h1><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;">Go语言的主要的功能在于令人简易使用的并行设计，这个方法叫做Goroutine，通过Goroutine能够让你的程序以异步的方式运行，而不需要担心一个函数导致程序中断，因此Go语言也非常地适合网络服务。</span></div><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;">我们通过go让其中一个函数同步运行，如此就不需要等待该函数运行完后才能运行下一个函数。</span></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">func main() {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">通过 `go`，我们可以把这个函数异步执行，这样</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">就不会阻塞往下执行。</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">go loop()</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">执行 Other</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div></div></div><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;">Goroutine是类似线程的概念（但Goroutine并不是线程）。线程属于系统层面，通常来说创建一个新的线程会消耗较多的资源且管理不易。而 Goroutine就像轻量级的线程，但我们称其为并发，一个Go程序可以运行超过数万个 Goroutine，并且这些性能都是原生级的，随时都能够关闭、结束。一个核心里面可以有多个Goroutine，通过GOMAXPROCS参数你能够限制Gorotuine可以占用几个系统线程来避免失控。</span></div><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;">在内置的官方包中也不时能够看见Goroutine的应用，像是net/http中用来监听网络服务的函数实际上是创建一个不断运行循环的Goroutine。</span></div><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;"> </span></div><h2 style="padding: 0px; font-size: 21px; margin: 10px 0px;"><span style="font-size: 21px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.5; font-weight: bold;">设置同时执行的cpu数（GOMAXPROCS）</span></h2><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;">GOMAXPROCS 在调度程序优化后会去掉，默认用系统所有资源。</span></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">func main() {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">num :</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">= runtime.NumCPU()</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//本地机器的逻辑CPU个数</span></div><div><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">runtime.GOMAXPROCS(num)</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//设置可同时执行的最大CPU数，并返回先前的设置</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">fmt.Println(num)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div></div></div><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;"> </span></div><h2 style="padding: 0px; font-size: 21px; margin: 10px 0px;"><span style="font-size: 21px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.5; font-weight: bold;">Goroutine中使用recover</span></h2><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;">应用场景，如果某个goroutine panic了，而且这个goroutine里面没有捕获(recover)，那么整个进程就会挂掉。所以，好的习惯是每当go产生一个goroutine，就需要写下recover。</span></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">var</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">(</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">domainSyncChan</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">= make(chan</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">int</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">,</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">10</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">)</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">func domainPut(num</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">int</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">) {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">defer func() {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">err :</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">recover()</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">if</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">err !=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">nil {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">fmt.Println(</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">error to chan put.</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}()</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">domainSyncChan</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">&lt;-</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">num</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">panic(</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">error....</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">func main() {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">for</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">i :=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">0</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">; i &lt;</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">10</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">; i++</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">{</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">domainName :</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">i</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">go domainPut(domainName)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">time.Sleep(time.Second</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">*</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">2</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div></div></div><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;"> </span></div><h2 style="padding: 0px; font-size: 21px; margin: 10px 0px;"><span style="font-size: 21px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.5; font-weight: bold;">Goroutine 栗子</span></h2><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">package main</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">import (</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">fmt</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">sync</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">time</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">)</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">var</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">(</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">m</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">= make(map[</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">int</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">]uint64)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">lock</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">sync.Mutex</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">申明一个互斥锁</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">)</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">type task</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">struct</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">{</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">n</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">int</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">func calc(t</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">*</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">task) {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">defer func() {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">err :</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">recover()</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">if</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">err !=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">nil {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">fmt.Println(</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">error...</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">return</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}()</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">var</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">sum uint64</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">sum</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">1</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">for</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">i :=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">1</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">; i &lt; t.n; i++</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">{</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">sum</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">*=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">uint64(i)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">lock</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">.Lock()</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">写全局数据加互斥锁</span></div><div><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">m[t.n] =</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">sum</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">lock</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">.Unlock()</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">解锁</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">func main() {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">for</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">i :=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">0</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">; i &lt;</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">10</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">; i++</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">{</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">t :</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">= &amp;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">task{n: i}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">go calc(t)</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">Goroutine来执行任务</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">time.Sleep(time.Second)</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">Goroutine异步，所以等一秒到任务完成</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">lock</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">.Lock()</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">读全局数据加锁</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">for</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">k, v :=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">range m {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">fmt.Printf(</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">%d! = %v\n</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">, k, v)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">fmt.Println(len(m))</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">lock</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">.Unlock()</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">解锁</span></div><div><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">}</span></div></div></div><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;"> </span></div><h1 style="padding: 0px; font-size: 28px; margin: 10px 0px;"><span style="font-size: 28px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.5; font-weight: bold;">Channel</span></h1><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;">channel，管道、队列，先进先出，用来异步传递数据。channel加上goroutine，就形成了一种既简单又强大的请求处理模型，使高并发和线程同步之间代码的编写变得异常简单。</span></div><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;">线程安全，多个goroutine同时访问，不需要加锁。</span></div><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;">channel是有类型的，一个整数的channel只能存放整数。</span></div><h2 style="padding: 0px; font-size: 21px; margin: 10px 0px;"><span style="font-size: 21px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.5; font-weight: bold;">channel使用</span></h2><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">chan申明</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">var</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">userChan chan</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">interface</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">{}</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">chan里面放interface类型</span></div><div><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">userChan = make(chan</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">interface</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">{},</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">10</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">)</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">make初始化，大小为10</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">var</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">readOnlyChan &lt;-chan</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">int</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">只读chan</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">var</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">writeOnlyChan chan&lt;-</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">int</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">只写chan</span></div></div></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">chan放取数据</span></div><div><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">userChan &lt;-</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">nick</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">name :</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">= &lt;-</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">userChan</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">name, ok :</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">= &lt;- userChan</span></div></div></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">关闭chan</span></div><div><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">intChan := make(chan</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">int</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">,</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">1</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">intChan</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">&lt;-</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">9</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">close(intChan)</span></div></div></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">range chan</span></div><div><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">intChan := make(chan</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">int</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">,</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">10</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">for</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">i :=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">0</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">; i &lt;</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">10</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">; i++</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">{</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">intChan</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">&lt;-</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">i</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">close(intChan)</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">for</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">v :=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">range intChan {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">fmt.Println(v)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div></div></div><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;">  </span></div><h3 style="padding: 0px; font-size: 16px; margin: 10px 0px;"><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.5; font-weight: bold;">放入chan数据个数超过初始化指定大小会怎样？</span></h3><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">userChan := make(chan</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">interface</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">{})</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">userChan</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">&lt;-</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">nick</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">错误！fatal error: all goroutines are asleep - deadlock!</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">开启race会一直阻塞</span></div></div></div><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;">开启一个goroutine来放入初始化未指定大小的chan不会报错。</span></div><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;">即放即走，在等放入时有来拿数据的，就直接拿走。</span></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">userChan := make(chan</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">interface</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">{})</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">go func() {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">userChan</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">&lt;-</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">nick</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}()</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">name :</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">= &lt;-</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">userChan</span></div></div></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">userChan := make(chan</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">interface</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">{})</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">go func() {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">for</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">{</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">userChan</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">&lt;-</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">nick</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}()</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">for</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">{</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">name :</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">= &lt;-</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">userChan</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">fmt.Println(name)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">time.Sleep(time.Millisecond)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div></div></div><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;"> </span></div><h3 style="padding: 0px; font-size: 16px; margin: 10px 0px;"><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.5; font-weight: bold;">chan关闭与不关闭</span></h3><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;">关闭chan后再放入数据会 panic: send on closed channel。</span></div><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;">chan不关闭取超数据的情况会报 deadlock</span></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">func main() {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">intChan :</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">= make(chan</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">int</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">,</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">10</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">)</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">for</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">i :=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">0</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">; i &lt;</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">10</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">; i++</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">{</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">intChan</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">&lt;-</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">i</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">for</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">{</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//十次后</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">fatal error: all goroutines are asleep - deadlock!</span></div><div><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">i := &lt;-</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">intChan</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">fmt.Println(i)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">time.Sleep(time.Second)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div></div></div><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;">chan关闭的情况取超出值为类型默认值，如int为0</span></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">func main() {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">intChan :</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">= make(chan</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">int</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">,</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">10</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">)</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">for</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">i :=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">0</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">; i &lt;</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">10</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">; i++</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">{</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">intChan</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">&lt;-</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">i</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">close(intChan)</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">for</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">{</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">i :</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">= &lt;-</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">intChan</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">十次后i值都为0，不报错</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">time.Sleep(time.Second)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">fmt.Println(i)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div></div></div><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;">判断chan是否取完</span></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">func main() {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">intChan :</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">= make(chan</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">int</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">,</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">10</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">)</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">for</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">i :=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">0</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">; i &lt;</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">10</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">; i++</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">{</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">intChan</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">&lt;-</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">i</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">close(intChan)</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">for</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">{</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">i, ok :</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">= &lt;-</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">intChan</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">if</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">!</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">ok {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">fmt.Println(</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">channel is close.</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">return</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">fmt.Println(i)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div></div></div><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;"> </span></div><h2 style="padding: 0px; font-size: 21px; margin: 10px 0px;"><span style="font-size: 21px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.5; font-weight: bold;">channel 栗子</span></h2><h3 style="padding: 0px; font-size: 16px; margin: 10px 0px;"><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.5; font-weight: bold;">栗子一</span></h3><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">func sendData(ch chan&lt;-</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">string</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">) {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">ch</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">&lt;-</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">go</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">ch</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">&lt;-</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">java</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">ch</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">&lt;-</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">c</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">ch</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">&lt;-</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">c++</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">ch</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">&lt;-</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">python</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">close(ch)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">func getData(ch</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">&lt;-chan</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">string</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">, chColse chan</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">bool</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">) {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">for</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">{</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">str, ok :</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">= &lt;-</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">ch</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">if</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">!</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">ok {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">fmt.Println(</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">chan is close.</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">break</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">fmt.Println(str)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">chColse</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">&lt;-</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">true</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">func main() {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">ch :</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">= make(chan</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">string</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">,</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">10</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">chColse :</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">= make(chan</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">bool</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">,</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">1</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">go sendData(ch)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">go getData(ch, chColse)</span></div><div><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">&lt;-</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">chColse</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">close(chColse)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div></div></div><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;"> </span></div><h3 style="padding: 0px; font-size: 16px; margin: 10px 0px;"><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.5; font-weight: bold;">栗子二：interface类型chan，取出后转化为对应类型。</span></h3><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">type user</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">struct</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">{</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">Name</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">string</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">func main() {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">userChan :</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">= make(chan</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">interface</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">{},</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">1</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">)</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">u :</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">= user{Name:</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">nick</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">userChan</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">&lt;- &amp;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">u</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">close(userChan)</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">var</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">u1</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">interface</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">{}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">u1</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">= &lt;-</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">userChan</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">var</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">u2 *</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">user</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">u2, ok :</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">= u1.(*</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">user)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">if</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">!</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">ok {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">fmt.Println(</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">cant not convert.</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">return</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">fmt.Println(u2)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div></div></div><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;"> </span></div><h2 style="padding: 0px; font-size: 21px; margin: 10px 0px;"><span style="font-size: 21px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.5; font-weight: bold;">channel 超时处理</span></h2><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;">利用select来处理chan超时。</span></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">for</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">{</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">select</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">{</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">case</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">v := &lt;-</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">chan1:</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">fmt.Println(v)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">case</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">v := &lt;-</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">chan2:</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">fmt.Println(v)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">default</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">:</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">time.Sleep(time.Second)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">fmt.Println(</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">timeout...</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div></div></div><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;">time.After()定时器来做处理。</span></div><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;">在time.After()计时器触发之前，底层计时器不会被垃圾收集器回收。</span></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">select</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">{</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">case</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">m := &lt;-</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">c:</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">handle(m)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">case</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">&lt;-time.After(</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">5</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">*</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">time.Minute):</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">fmt.Println(</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">timed out</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div></div></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;"><img src="Go语言学习笔记（七）杀手锏 Goroutine + Channel_files/ContractedBlock.gif" type="image/gif" data-filename="ContractedBlock.gif" height="16" style="margin:0px;padding:0px;border:0px;height:auto;vertical-align:middle;padding-right:5px;max-width:300px;" width="11"/></span><span style="margin: 0px; border: 1px solid gray; background-color: rgb(255, 255, 255); padding: 2px; font-size: 12px; color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">定时器栗子</span></div><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;"> </span></div><h1 style="padding: 0px; font-size: 28px; margin: 10px 0px;"><span style="font-size: 28px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.5; font-weight: bold;">Goroutine+Channel 栗子</span></h1><h2 style="padding: 0px; font-size: 21px; margin: 10px 0px;"><span style="font-size: 21px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.5; font-weight: bold;">栗子一</span></h2><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;">多个goroutine处理任务；</span></div><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;">等待一组channel的返回结果。</span></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">func calc(taskChan, resChan chan</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">int</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">, exitChan chan</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">bool</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">) {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">defer func() {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">err :</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">recover()</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">if</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">err !=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">nil {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">fmt.Println(</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">error...</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 0); font-family: 'Courier New'; line-height: 1.5;">&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">return</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}()</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">for</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">v :=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">range taskChan {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">任务处理逻辑</span></div><div><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">flag :=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">true</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">for</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">i :=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">2</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">; i &lt; v; i++</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">{</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">if</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">v%i ==</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">0</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">{</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">flag</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">false</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">break</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">if</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">flag {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">结果进chan</span></div><div><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">resChan &lt;-</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">v</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">处理完进退出chan</span></div><div><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">exitChan &lt;-</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">true</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">func main() {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">任务chan</span></div><div><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">intChan := make(chan</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">int</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">,</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">1000</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">结果chan</span></div><div><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">resChan := make(chan</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">int</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">,</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">1000</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">退出chan</span></div><div><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">exitChan := make(chan</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">bool</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">,</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">8</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">)</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">go func() {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">for</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">i :=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">0</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">; i &lt;</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">1000</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">; i++</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">{</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">intChan</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">&lt;-</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">i</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">close(intChan)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}()</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">启动8个goroutine做任务</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">for</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">i :=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">0</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">; i &lt;</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">8</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">; i++</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">{</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">go calc(intChan, resChan, exitChan)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">go func() {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 128, 0); font-family: 'Courier New'; line-height: 1.5;">等所有goroutine结束</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">for</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">i :=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">0</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">; i &lt;</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(128, 0, 128); font-family: 'Courier New'; line-height: 1.5;">8</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">; i++</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">{</span></div><div><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">&lt;-</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">exitChan</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">close(resChan)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">close(exitChan)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}()</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">for</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">v :=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">range resChan {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">fmt.Println(v)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div></div></div><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;"> </span></div><h2 style="padding: 0px; font-size: 21px; margin: 10px 0px;"><span style="font-size: 21px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.5; font-weight: bold;">栗子二</span></h2><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;">等待一组channel的返回结果 sync.WaitGroup 的解决方法。</span></div><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;">WaitGroup用于等待一组线程的结束。父线程调用Add方法来设定应等待的线程的数量。每个被等待的线程在结束时应调用Done方法。同时，主线程里可以调用Wait方法阻塞至所有线程结束。</span></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">func merge(cs &lt;-chan</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">int</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">) &lt;-chan</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">int</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">{</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">var</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">wg sync.WaitGroup</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">out</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">:= make(chan</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">int</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">)</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">output :</span><span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">= func(c &lt;-chan</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">int</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">) {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">for</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">n :=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">range c {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">out</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">&lt;-</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">n</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">wg.Done()</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">wg.Add(len(cs))</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">for</span> <span style="font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.7;">_, c :=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">range cs {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">go output(c)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">go func() {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">wg.Wait()</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">close(</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">out</span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}()</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">return</span> <span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 255); font-family: 'Courier New'; line-height: 1.5;">out</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: 'Courier New'; line-height: 1.5;">}</span></div></div></div><div style="padding: 0px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.7;"> </span></div></div></div></div></div></div></div></div></div><div><br/></div></span>
</div></body></html> 